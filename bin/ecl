#!/usr/bin/env node

var program   = require("commander")
var path      = require("path")
var yo        = require("yeoman-generator")
var nodemon   = require("nodemon")

program
  .version(require("../package.json").version)

program
  .command("install")
  .description("Installs Eclectus")
  .action(function(){
    yo("eclectus")
      .register(electusGenerator("config"), "eclectus")
      .run()
  })

program
  .command("start")
  .description("Starts the Eclectus server")
  .action(function(){
    // console.log(__dirname)
    // console.log(process.cwd())
    // console.log(path.resolve())
    require("coffee-script/register");

    var server = path.join(__dirname, "..", "lib", "server.coffee")

    nodemon({
      script: server,
      watch: [server]
    })

    nodemon.on("start", function(){
      console.log("app has started")
    })

    nodemon.on("restart", function(files){
      console.log("app has restarted", files)
    })
  })

program.parse(process.argv)

function electusGenerator(name){
  return path.join(__dirname, "..", "lib", "generator-eclectus", name)
}